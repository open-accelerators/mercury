# camel-k: language=yaml
# camel-k: dependency=mvn:com.redhat.mercury:mercury-camel:1.0.1-SNAPSHOT
- from:
    uri: direct:command
    steps:
      - bean:
          bean-type: com.redhat.mercury.camel.CloudEventBuilder
          method: build
      - to: grpc://{{mercury.binding.service.host}}:{{mercury.binding.service.port}}/org.bian.protobuf.BindingService?synchronous=true&method=command
      - set-body:
          constant: ""
      - set-header:
          name: CamelHttpResponseCode
          constant: "202"
- from:
    uri: direct:query
    steps:
      - bean:
          bean-type: com.redhat.mercury.camel.CloudEventBuilder
          method: build
      - to: grpc://{{mercury.binding.service.host}}:{{mercury.binding.service.port}}/org.bian.protobuf.BindingService?synchronous=true&method=query
      - to: direct:print
      - choice:
          when:
              - simple: "${body} == null"
                steps:
                  - set-header:
                      name: CamelHttpResponseCode
                      constant: "404"
- from:
    uri: direct:print
    steps:
      - remove-header:
          name: serviceDomainName
      - remove-header:
          name: cloudEventType
      - bean:
          ref: com.redhat.mercury.camel.CloudEventPrinter
          method: print